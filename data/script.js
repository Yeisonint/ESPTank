let socket=new WebSocket("ws://"+window.location.host+":81");function sendCommand(e){socket.readyState===WebSocket.OPEN?socket.send(e):console.warn("⏳ WebSocket no está listo. Estado:",socket.readyState)}socket.onopen=function(){console.log("✅ WebSocket conectado!")},socket.onerror=function(e){console.error("❌ WebSocket error:",e)},socket.onclose=function(){console.warn("⚠️ WebSocket desconectado. Reconectando en 3 segundos..."),setTimeout(()=>location.reload(),3e3)},document.addEventListener("keydown",o=>{if(!o.repeat){let e="";"w"===o.key?e="forward":"s"===o.key?e="backward":"a"===o.key?e="left":"d"===o.key&&(e="right"),e&&sendCommand(e)}}),document.addEventListener("keyup",()=>sendCommand("stop"));let gamepadIndex=null,lastSentCommand="";function pollGamepad(){if(null!==gamepadIndex){var o=navigator.getGamepads()[gamepadIndex];if(o){var n=o.buttons[12].pressed,t=o.buttons[13].pressed,d=o.buttons[14].pressed,o=o.buttons[15].pressed;let e="";(e=n?"forward":t?"backward":d?"left":o?"right":"stop")!==lastSentCommand&&(sendCommand(e),lastSentCommand=e)}}}window.addEventListener("gamepadconnected",e=>{console.log("🎮 Control conectado:",e.gamepad),gamepadIndex=e.gamepad.index}),window.addEventListener("gamepaddisconnected",()=>{console.log("🎮 Control desconectado"),gamepadIndex=null}),setInterval(pollGamepad,100);